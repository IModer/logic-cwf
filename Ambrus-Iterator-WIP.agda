{-# OPTIONS --prop --rewriting #-}

open import Agda.Primitive
open import Lib
open import model
open import Syntax

module Iterator
  (funar : â„• â†’ Set)
  (relar : â„• â†’ Set)
  {i}{j}{k}
  (M : Model funar relar {i}{j}{k})
  where

module M = Model M

cong-,â‚š : âˆ€{Î“ Î”}{Î³ Î³' : M.Sub Î” Î“} â†’ Î³ â‰¡ Î³' â†’ âˆ€{A}{a : M.Pf Î” (A M.[ Î³ ]á¶ )}{a' : M.Pf Î” (A M.[ Î³' ]á¶ )} â†’ Î³ M.,â‚š a â‰¡ Î³' M.,â‚š a'
cong-,â‚š refl = refl

subst-[]á¶  : âˆ€{Î“}{A : M.For Î“}{Î”}{Î³ : M.Sub Î” Î“}{Î”'}(e : Î” â‰¡ Î”') â†’
  subst M.For e (A M.[ Î³ ]á¶ ) â‰¡ A M.[ subst (Î» z â†’ M.Sub z Î“) e Î³ ]á¶ 
subst-[]á¶  refl = refl

,â‚œâˆ˜ : âˆ€{Î“ Î”}{Î³ : M.Sub Î” Î“}{t : M.Tm Î”}{Î˜}{Î´ : M.Sub Î˜ Î”} â†’
  (Î³ M.,â‚œ t) M.âˆ˜ Î´ â‰¡ Î³ M.âˆ˜ Î´ M.,â‚œ (t M.[ Î´ ]áµ—)
,â‚œâˆ˜ {Î³ = Î³}{Î´ = Î´} = M.â–¹â‚œÎ· â—¾ congâ‚‚ M._,â‚œ_ (M.ass â»Â¹ â—¾ cong (M._âˆ˜ Î´) M.â–¹â‚œÎ²â‚) (M.[âˆ˜]áµ— â—¾ cong (M._[ Î´ ]áµ—) M.â–¹â‚œÎ²â‚‚)

,â‚šâˆ˜ : âˆ€{Î“ Î”}{Î³ : M.Sub Î” Î“}{A}{a : M.Pf Î” (A M.[ Î³ ]á¶ )}{Î˜}{Î´ : M.Sub Î˜ Î”} â†’
  (Î³ M.,â‚š a) M.âˆ˜ Î´ â‰¡ Î³ M.âˆ˜ Î´ M.,â‚š substP (M.Pf Î˜) (M.[âˆ˜]á¶  â»Â¹) (a M.[ Î´ ]áµ–)
,â‚šâˆ˜ {Î“}{Î”}{Î³}{A}{a}{Î˜}{Î´} = M.â–¹â‚šÎ· â—¾ cong-,â‚š (M.ass â»Â¹ â—¾ cong (M._âˆ˜ Î´) M.â–¹â‚šÎ²â‚)

data Fors (Î“ : M.Con) : Set i
_â–¹â‚šâ‚›_ : (Î“ : M.Con) â†’ Fors Î“ â†’ M.Con
data Fors Î“ where
  â—‡    : Fors Î“
  _â–¹â‚š_ : (As : Fors Î“) â†’ M.For (Î“ â–¹â‚šâ‚› As) â†’ Fors Î“
Î“ â–¹â‚šâ‚› â—‡         = Î“
Î“ â–¹â‚šâ‚› (As â–¹â‚š A) = (Î“ â–¹â‚šâ‚› As) M.â–¹â‚š A

cong-â–¹â‚š : âˆ€{Î“}{As As' : Fors Î“}(e : As â‰¡ As'){A : M.For (Î“ â–¹â‚šâ‚› As)}{A' : M.For (Î“ â–¹â‚šâ‚› As')} â†’
  subst (Î» z â†’ M.For (Î“ â–¹â‚šâ‚› z)) e A â‰¡ A' â†’ As â–¹â‚š A â‰¡ As' â–¹â‚š A'
cong-â–¹â‚š refl refl = refl

_[_]á¶ Ë¢  : âˆ€{Î“} â†’ Fors Î“ â†’ âˆ€{Î”} â†’ M.Sub Î” Î“ â†’ Fors Î”
_âºáµ–Ë¢_   : âˆ€{Î“ Î”}(Î³ : M.Sub Î” Î“)(As : Fors Î“) â†’ M.Sub (Î” â–¹â‚šâ‚› (As [ Î³ ]á¶ Ë¢)) (Î“ â–¹â‚šâ‚› As)
â—‡         [ Î³ ]á¶ Ë¢ = â—‡
(As â–¹â‚š A) [ Î³ ]á¶ Ë¢ = As [ Î³ ]á¶ Ë¢ â–¹â‚š A M.[ Î³ âºáµ–Ë¢ As ]á¶ 
Î³ âºáµ–Ë¢ â—‡         = Î³
Î³ âºáµ–Ë¢ (As â–¹â‚š A) = Î³ âºáµ–Ë¢ As M.âˆ˜ M.pâ‚š M.,â‚š substP (M.Pf _) (M.[âˆ˜]á¶  â»Â¹) M.qâ‚š

[âˆ˜]á¶ Ë¢  : âˆ€{Î“ As}{Î”}{Î³ : M.Sub Î” Î“}{Î˜}{Î´ : M.Sub Î˜ Î”} â†’ As [ Î³ M.âˆ˜ Î´ ]á¶ Ë¢ â‰¡ As [ Î³ ]á¶ Ë¢ [ Î´ ]á¶ Ë¢
âˆ˜âºáµ–Ë¢   : âˆ€{Î“ As}{Î”}{Î³ : M.Sub Î” Î“}{Î˜}{Î´ : M.Sub Î˜ Î”} â†’
  subst (Î» z â†’ M.Sub (Î˜ â–¹â‚šâ‚› z) (Î“ â–¹â‚šâ‚› As)) ([âˆ˜]á¶ Ë¢ {As = As}) ((Î³ M.âˆ˜ Î´) âºáµ–Ë¢ As) â‰¡ (Î³ âºáµ–Ë¢ As) M.âˆ˜ (Î´ âºáµ–Ë¢ (As [ Î³ ]á¶ Ë¢))
[âˆ˜]á¶ Ë¢ {As = â—‡} = refl
[âˆ˜]á¶ Ë¢ {As = As â–¹â‚š A}{Î³ = Î³}{Î˜}{Î´} = cong-â–¹â‚š
  ([âˆ˜]á¶ Ë¢ {As = As})
  (subst-[]á¶  {A = A}{Î³ = (Î³ M.âˆ˜ Î´) âºáµ–Ë¢ As} (cong (Î˜ â–¹â‚šâ‚›_) ([âˆ˜]á¶ Ë¢ {As = As}{Î³ = Î³}{Î´ = Î´})) â—¾ cong (A M.[_]á¶ ) (âˆ˜âºáµ–Ë¢  {As = As}) â—¾ M.[âˆ˜]á¶ )
âˆ˜âºáµ–Ë¢ {As = â—‡} = refl
âˆ˜âºáµ–Ë¢ {As = As â–¹â‚š A}{Î³ = Î³}{Î˜}{Î´} = {!(âˆ˜âºáµ–Ë¢ {As = As} {Î³ = Î³}{Î´ = Î´})!}
[id]á¶ Ë¢ : âˆ€{Î“}{As : Fors Î“} â†’ As [ M.id ]á¶ Ë¢ â‰¡ As
idâºáµ–Ë¢  : âˆ€{Î“}{As : Fors Î“} â†’ subst (Î» z â†’ M.Sub (Î“ â–¹â‚šâ‚› z) (Î“ â–¹â‚šâ‚› As)) ([id]á¶ Ë¢ {As = As}) (M.id âºáµ–Ë¢ As) â‰¡ M.id
[id]á¶ Ë¢ {Î“} {â—‡} = refl
[id]á¶ Ë¢ {Î“} {As â–¹â‚š A} = cong-â–¹â‚š
  ([id]á¶ Ë¢ {As = As})
  ({!subst-[]á¶  {A = A}{Î³ = M.id âºáµ–Ë¢ As}!} â—¾ cong (A M.[_]á¶ ) (idâºáµ–Ë¢ {As = As}) â—¾ M.[id]á¶ )
idâºáµ–Ë¢ {Î“}{As} = {!!}

Pfs : (Î“ : M.Con) â†’ Fors Î“ â†’ Prop k
âŸ¨_âŸ©áµ–Ë¢ : âˆ€{Î“ As} â†’ Pfs Î“ As â†’ M.Sub Î“ (Î“ â–¹â‚šâ‚› As)
Pfs Î“ â—‡ = ğŸ™p
Pfs Î“ (As â–¹â‚š A) = Î£p (Pfs Î“ As) Î» as â†’ M.Pf Î“ (A M.[ âŸ¨ as âŸ©áµ–Ë¢ ]á¶ )
âŸ¨_âŸ©áµ–Ë¢ {Î“} {â—‡}       _        = M.id
âŸ¨_âŸ©áµ–Ë¢ {Î“} {As â–¹â‚š A} (as ,p a) = âŸ¨ as âŸ©áµ–Ë¢ M.,â‚š a

_[_]áµ–Ë¢ : âˆ€{Î“ As Î”} â†’ Pfs Î“ As â†’ (Î³ : M.Sub Î” Î“) â†’ Pfs Î” (As [ Î³ ]á¶ Ë¢)
âºâŸ¨âŸ©áµ–Ë¢  : âˆ€{Î“ As Î”}{as : Pfs Î“ As}{Î³ : M.Sub Î” Î“} â†’ (Î³ âºáµ–Ë¢ As) M.âˆ˜ âŸ¨ as [ Î³ ]áµ–Ë¢ âŸ©áµ–Ë¢ â‰¡ âŸ¨ as âŸ©áµ–Ë¢ M.âˆ˜ Î³
_[_]áµ–Ë¢ {As = â—‡}       _         Î³ = tt
_[_]áµ–Ë¢ {As = As â–¹â‚š A} (as ,p a) Î³ = (as [ Î³ ]áµ–Ë¢) ,p substP (M.Pf _) (M.[âˆ˜]á¶  â»Â¹ â—¾ cong (A M.[_]á¶ ) (âºâŸ¨âŸ©áµ–Ë¢ {As = As} â»Â¹) â—¾ M.[âˆ˜]á¶ ) (a M.[ Î³ ]áµ–)
âºâŸ¨âŸ©áµ–Ë¢ {As = â—‡} = M.idr â—¾ M.idl â»Â¹
âºâŸ¨âŸ©áµ–Ë¢ {Î“}{As â–¹â‚š A}{Î”}{as ,p a}{Î³} = ,â‚šâˆ˜ â—¾ cong-,â‚š (M.ass â—¾ cong ((Î³ âºáµ–Ë¢ As) M.âˆ˜_) M.â–¹â‚šÎ²â‚ â—¾ âºâŸ¨âŸ©áµ–Ë¢ {As = As}) â—¾ ,â‚šâˆ˜ â»Â¹

pâ‚šâ‚› : âˆ€{Î“ As} â†’ M.Sub (Î“ â–¹â‚šâ‚› As) Î“
pâ‚šâ‚› {As = â—‡}       = M.id
pâ‚šâ‚› {As = As â–¹â‚š A} = pâ‚šâ‚› {As = As} M.âˆ˜ M.pâ‚š

qâ‚šâ‚› : âˆ€{Î“ As} â†’ Pfs (Î“ â–¹â‚šâ‚› As) (As [ pâ‚šâ‚› {As = As} ]á¶ Ë¢)
â–¹â‚šâ‚›Î· : âˆ€{Î“ As} â†’ (pâ‚šâ‚› {As = As} âºáµ–Ë¢ As) M.âˆ˜ âŸ¨ qâ‚šâ‚› {As = As} âŸ©áµ–Ë¢ â‰¡ M.id {Î“ â–¹â‚šâ‚› As}
qâ‚šâ‚› {As = â—‡}       = tt
qâ‚šâ‚› {As = As â–¹â‚š A} = substP (Pfs _) ([âˆ˜]á¶ Ë¢ â»Â¹) (qâ‚šâ‚› {As = As} [ M.pâ‚š ]áµ–Ë¢) ,p
  substP (M.Pf _)
         (cong (A M.[_]á¶ ) {!? â—¾ âºâŸ¨âŸ©áµ–Ë¢ {As = As}{Î³ = pâ‚šâ‚› M.âˆ˜ M.pâ‚š} â»Â¹!} â—¾ M.[âˆ˜]á¶ )
         M.qâ‚š
â–¹â‚šâ‚›Î· {As = As} = {!!}

_,â‚šâ‚›_ : âˆ€{Î“ Î”}(Î³ : M.Sub Î” Î“){As}(as : Pfs Î” (As [ Î³ ]á¶ Ë¢)) â†’ M.Sub Î” (Î“ â–¹â‚šâ‚› As)
_,â‚šâ‚›_ Î³ {As} as = (Î³ âºáµ–Ë¢ As) M.âˆ˜ âŸ¨ as âŸ©áµ–Ë¢

module S = Syntax funar relar
module I = Model S.I

âŸ¦_âŸ§Ct : S.Con â†’ M.Con
âŸ¦ â—‡ âŸ§Ct = M.â—‡
âŸ¦ Î“ â–¹â‚œ âŸ§Ct = âŸ¦ Î“ âŸ§Ct M.â–¹â‚œ

âŸ¦_âŸ§F' : âˆ€{Î“â‚œ} â†’ S.For Î“â‚œ â†’ M.For âŸ¦ Î“â‚œ âŸ§Ct

âŸ¦_âŸ§Cp : âˆ€{Î“â‚œ} â†’ S.Conp Î“â‚œ â†’ Fors âŸ¦ Î“â‚œ âŸ§Ct
âŸ¦ â—‡â‚š âŸ§Cp = â—‡
âŸ¦ Î“â‚š â–¹â‚š A âŸ§Cp = âŸ¦ Î“â‚š âŸ§Cp â–¹â‚š âŸ¦ A âŸ§F' M.[ pâ‚šâ‚› {As = âŸ¦ Î“â‚š âŸ§Cp} ]á¶ 

âŸ¦_âŸ§T' : âˆ€{Î“â‚œ} â†’ S.Tm Î“â‚œ â†’ M.Tm âŸ¦ Î“â‚œ âŸ§Ct
âŸ¦_âŸ§Ts' : âˆ€{n Î“â‚œ} â†’ S.Tm Î“â‚œ ^ n â†’ M.Tm âŸ¦ Î“â‚œ âŸ§Ct ^ n
âŸ¦ var vz âŸ§T' = M.qâ‚œ
âŸ¦ var (vs x) âŸ§T' = âŸ¦ var x âŸ§T' M.[ M.pâ‚œ ]áµ—
âŸ¦ fun ar ts âŸ§T' = M.fun ar âŸ¦ ts âŸ§Ts'
âŸ¦_âŸ§Ts' {zero} ts = _
âŸ¦_âŸ§Ts' {suc n} (t , ts) = âŸ¦ t âŸ§T' , âŸ¦ ts âŸ§Ts'

âŸ¦ A âŠƒ B âŸ§F' = âŸ¦ A âŸ§F' M.âŠƒ âŸ¦ B âŸ§F'
âŸ¦ A âˆ§ B âŸ§F' = âŸ¦ A âŸ§F' M.âˆ§ âŸ¦ B âŸ§F'
âŸ¦ âŠ¤ âŸ§F' = M.âŠ¤
âŸ¦ A âˆ¨ B âŸ§F' = âŸ¦ A âŸ§F' M.âˆ¨ âŸ¦ B âŸ§F'
âŸ¦ âŠ¥ âŸ§F' = M.âŠ¥
âŸ¦ Forall A âŸ§F' = M.Forall âŸ¦ A âŸ§F'
âŸ¦ âˆƒ A âŸ§F' = M.âˆƒ âŸ¦ A âŸ§F'
âŸ¦ Rel ar ts âŸ§F' = M.Rel ar âŸ¦ ts âŸ§Ts'

âŸ¦_âŸ§C : I.Con â†’ M.Con
âŸ¦ Î“â‚œ , Î“â‚š âŸ§C = âŸ¦ Î“â‚œ âŸ§Ct â–¹â‚šâ‚› âŸ¦ Î“â‚š âŸ§Cp

âŸ¦_âŸ§F : âˆ€{Î“} â†’ I.For Î“ â†’ M.For âŸ¦ Î“ âŸ§C
âŸ¦_âŸ§F {Î“â‚œ , Î“â‚š} A = âŸ¦ A âŸ§F' M.[ pâ‚šâ‚› {As = âŸ¦ Î“â‚š âŸ§Cp} ]á¶ 

âŸ¦_âŸ§st : âˆ€{Î”â‚œ Î“â‚œ}(Î³â‚œ : S.Sub Î”â‚œ Î“â‚œ) â†’ M.Sub âŸ¦ Î”â‚œ âŸ§Ct âŸ¦ Î“â‚œ âŸ§Ct
âŸ¦ Îµ âŸ§st = M.Îµ
âŸ¦ Î³â‚œ ,â‚œ t âŸ§st = âŸ¦ Î³â‚œ âŸ§st M.,â‚œ âŸ¦ t âŸ§T'

âŸ¦[]âŸ§ts : âˆ€{Î“â‚œ}{n}{ts : S.Tm Î“â‚œ ^ n}{Î”â‚œ}{Î³â‚œ : S.Sub Î”â‚œ Î“â‚œ} â†’ âŸ¦ ts S.[ Î³â‚œ ]áµ—s âŸ§Ts' â‰¡ map (M._[ âŸ¦ Î³â‚œ âŸ§st ]áµ—) âŸ¦ ts âŸ§Ts'
âŸ¦[]âŸ§t : âˆ€{Î“â‚œ}{t : S.Tm Î“â‚œ}{Î”â‚œ}{Î³â‚œ : S.Sub Î”â‚œ Î“â‚œ} â†’ âŸ¦ t S.[ Î³â‚œ ]áµ— âŸ§T' â‰¡ âŸ¦ t âŸ§T' M.[ âŸ¦ Î³â‚œ âŸ§st ]áµ—
âŸ¦[]âŸ§ts {n = zero} = refl
âŸ¦[]âŸ§ts {n = suc n}{t , ts} = congâ‚‚ _,_ (âŸ¦[]âŸ§t {t = t}) (âŸ¦[]âŸ§ts {n = n})
âŸ¦[]âŸ§t {t = var vz}{Î³â‚œ = Î³â‚œ ,â‚œ t} = M.â–¹â‚œÎ²â‚‚ â»Â¹
âŸ¦[]âŸ§t {t = var (vs x)}{Î³â‚œ = Î³â‚œ ,â‚œ t} = âŸ¦[]âŸ§t {t = var x} â—¾ cong (âŸ¦ S.var x âŸ§T' M.[_]áµ—) (M.â–¹â‚œÎ²â‚ â»Â¹) â—¾ M.[âˆ˜]áµ—
âŸ¦[]âŸ§t {t = fun ar ts} = cong (M.fun ar) (âŸ¦[]âŸ§ts {ts = ts}) â—¾ M.fun[] â»Â¹

âŸ¦pâ‚œâŸ§ : âˆ€{Î“â‚œ} â†’ âŸ¦ S.pâ‚œ {Î“â‚œ} âŸ§st â‰¡ M.pâ‚œ
âŸ¦pâ‚œâŸ§ {â—‡} = M.â—‡Î· â»Â¹
âŸ¦pâ‚œâŸ§ {Î“â‚œ â–¹â‚œ} = {!!}

âŸ¦âˆ˜âŸ§st : âˆ€{Î”â‚œ Î“â‚œ}{Î³â‚œ : S.Sub Î”â‚œ Î“â‚œ}{Î˜â‚œ}{Î´â‚œ : S.Sub Î˜â‚œ Î”â‚œ} â†’ âŸ¦ Î³â‚œ S.âˆ˜ Î´â‚œ âŸ§st â‰¡ âŸ¦ Î³â‚œ âŸ§st M.âˆ˜ âŸ¦ Î´â‚œ âŸ§st
âŸ¦âˆ˜âŸ§st {Î³â‚œ = Îµ} = M.â—‡Î· â»Â¹
âŸ¦âˆ˜âŸ§st {Î³â‚œ = Î³â‚œ ,â‚œ t}{Î´â‚œ = Î´â‚œ} = congâ‚‚ M._,â‚œ_ (âŸ¦âˆ˜âŸ§st {Î³â‚œ = Î³â‚œ}{Î´â‚œ = Î´â‚œ}) (âŸ¦[]âŸ§t {t = t}{Î³â‚œ = Î´â‚œ}) â—¾ ,â‚œâˆ˜ {t = âŸ¦ t âŸ§T'} â»Â¹

âŸ¦[]âŸ§F : âˆ€{Î“â‚œ}{A : S.For Î“â‚œ}{Î”â‚œ}{Î³â‚œ : S.Sub Î”â‚œ Î“â‚œ} â†’ âŸ¦ A S.[ Î³â‚œ ]á¶  âŸ§F' â‰¡ âŸ¦ A âŸ§F' M.[ âŸ¦ Î³â‚œ âŸ§st ]á¶ 
âŸ¦[]âŸ§F {A = A âŠƒ B} = congâ‚‚ M._âŠƒ_ (âŸ¦[]âŸ§F {A = A}) (âŸ¦[]âŸ§F {A = B}) â—¾ M.âŠƒ[] â»Â¹
âŸ¦[]âŸ§F {A = A âˆ§ B} = congâ‚‚ M._âˆ§_ (âŸ¦[]âŸ§F {A = A}) (âŸ¦[]âŸ§F {A = B}) â—¾ M.âˆ§[] â»Â¹
âŸ¦[]âŸ§F {A = âŠ¤} = M.âŠ¤[] â»Â¹
âŸ¦[]âŸ§F {A = A âˆ¨ B} = congâ‚‚ M._âˆ¨_ (âŸ¦[]âŸ§F {A = A}) (âŸ¦[]âŸ§F {A = B}) â—¾ M.âˆ¨[] â»Â¹
âŸ¦[]âŸ§F {A = âŠ¥} = M.âŠ¥[] â»Â¹
âŸ¦[]âŸ§F {A = Forall A}{Î³â‚œ = Î³â‚œ} = cong M.Forall (âŸ¦[]âŸ§F {A = A} â—¾ cong (âŸ¦ A âŸ§F' M.[_]á¶ ) (cong (M._,â‚œ M.qâ‚œ) (cong âŸ¦_âŸ§st (S.âˆ˜p {Î³ = Î³â‚œ} â»Â¹) â—¾ âŸ¦âˆ˜âŸ§st {Î³â‚œ = Î³â‚œ} â—¾ cong (âŸ¦ Î³â‚œ âŸ§st M.âˆ˜_) {!!}))) â—¾ M.Forall[] â»Â¹
âŸ¦[]âŸ§F {A = âˆƒ A} = {!!}
âŸ¦[]âŸ§F {A = Rel ar ts} = cong (M.Rel ar) âŸ¦[]âŸ§ts â—¾ M.Rel[] â»Â¹


âŸ¦[]âŸ§Cp : âˆ€{Î“â‚œ}{Î“â‚š : S.Conp Î“â‚œ}{Î”â‚œ}{Î³â‚œ : S.Sub Î”â‚œ Î“â‚œ} â†’ âŸ¦ Î“â‚š S.[ Î³â‚œ ]Conp âŸ§Cp â‰¡ (âŸ¦ Î“â‚š âŸ§Cp [ âŸ¦ Î³â‚œ âŸ§st ]á¶ Ë¢) -- âŸ¦ Î“â‚š âŸ§Cp M.[ Î³ ]C
âŸ¦[]âŸ§Cp {Î“â‚œ}{Î“â‚š = â—‡â‚š}               = refl
âŸ¦[]âŸ§Cp {Î“â‚œ}{Î“â‚š = Î“â‚š â–¹â‚š A}{Î”â‚œ}{Î³â‚œ} = cong-â–¹â‚š (âŸ¦[]âŸ§Cp {Î“â‚œ}{Î“â‚š}{Î”â‚œ}{Î³â‚œ}) ({!!} â—¾ M.[âˆ˜]á¶ )
-- {!âŸ¦[]âŸ§Cp {Î“â‚š = Î“â‚š}{Î”â‚œ}{}!}

âŸ¦_âŸ§P : âˆ€{Î“ A} â†’ I.Pf Î“ A â†’ M.Pf âŸ¦ Î“ âŸ§C (âŸ¦_âŸ§F {Î“} A)
âŸ¦ a [ Î³â‚œ ]áµ– âŸ§P = substP (M.Pf _) {!!} (âŸ¦ a âŸ§P M.[ {!Î³â‚œ!} ]áµ–)
âŸ¦ a [ Î³â‚š ]áµ–áµ– âŸ§P = {!!}
âŸ¦ qâ‚š âŸ§P = substP (M.Pf _) (M.[âˆ˜]á¶  â»Â¹) M.qâ‚š
âŸ¦ âŠƒin b âŸ§P = substP (M.Pf _) (M.âŠƒ[] â»Â¹) (M.âŠƒin (substP (M.Pf _) M.[âˆ˜]á¶  âŸ¦ b âŸ§P))
âŸ¦ âŠƒout f a âŸ§P = M.âŠƒout (substP (M.Pf _) M.âŠƒ[] âŸ¦ f âŸ§P) âŸ¦ a âŸ§P
âŸ¦ âˆ§in a b âŸ§P = substP (M.Pf _) (M.âˆ§[] â»Â¹) (M.âˆ§in âŸ¦ a âŸ§P âŸ¦ b âŸ§P)
âŸ¦ âˆ§outâ‚ a âŸ§P = M.âˆ§outâ‚ (substP (M.Pf _) M.âˆ§[] âŸ¦ a âŸ§P)
âŸ¦ âˆ§outâ‚‚ b âŸ§P = M.âˆ§outâ‚‚ (substP (M.Pf _) M.âˆ§[] âŸ¦ b âŸ§P)
âŸ¦ âŠ¤in âŸ§P = substP (M.Pf _) (M.âŠ¤[] â»Â¹) M.âŠ¤in
âŸ¦ âˆ¨inâ‚ a âŸ§P = substP (M.Pf _) (M.âˆ¨[] â»Â¹) (M.âˆ¨inâ‚ âŸ¦ a âŸ§P)
âŸ¦ âˆ¨inâ‚‚ b âŸ§P = substP (M.Pf _) (M.âˆ¨[] â»Â¹) (M.âˆ¨inâ‚‚ âŸ¦ b âŸ§P)
âŸ¦ âˆ¨out ac bc ab âŸ§P = M.âˆ¨out (substP (M.Pf _) M.[âˆ˜]á¶  âŸ¦ ac âŸ§P) (substP (M.Pf _) M.[âˆ˜]á¶  âŸ¦ bc âŸ§P) (substP (M.Pf _) M.âˆ¨[] âŸ¦ ab âŸ§P)
âŸ¦ âŠ¥out p âŸ§P = M.âŠ¥out (substP (M.Pf _) M.âŠ¥[] âŸ¦ p âŸ§P)
âŸ¦_âŸ§P {Î“â‚œ , Î“â‚š}{S.Forall A} (âˆ€in a) = substP (M.Pf _) (M.Forall[] â»Â¹)
  (M.âˆ€in (substP (M.Pf _)
                 (M.[âˆ˜]á¶  â»Â¹ â—¾ cong (Î» z â†’ âŸ¦ A âŸ§F' M.[ z ]á¶ ) {!!})
                         (âŸ¦ a âŸ§P M.[ _,â‚šâ‚›_ (pâ‚šâ‚› {As = âŸ¦ Î“â‚š âŸ§Cp} M.âˆ˜ M.pâ‚œ M.,â‚œ M.qâ‚œ) {âŸ¦ Î“â‚š S.[ S.pâ‚œ ]Conp âŸ§Cp}
                            (substP (Pfs _) {!!} (qâ‚šâ‚› {As = âŸ¦ Î“â‚š âŸ§Cp} [ M.pâ‚œ ]áµ–Ë¢)) ]áµ–)))
âŸ¦ âˆ€out p âŸ§P = {!!}
âŸ¦ âˆƒin t p âŸ§P = {!!}
âŸ¦ âˆƒout p pâ‚ âŸ§P = {!!}

{-
{-
âŸ¦_âŸ§C : I.Con â†’ M.Con

âŸ¦_âŸ§F' : âˆ€{Î“â‚œ} â†’ S.For Î“â‚œ â†’ M.For âŸ¦ Î“â‚œ âŸ§Ct


âŸ¦ Î“ , Î“â‚š âŸ§C = âŸ¦ Î“â‚š âŸ§Cp

âŸ¦pâŸ§ : âˆ€{Î“â‚œ}{Î“â‚š : S.Conp Î“â‚œ} â†’ M.Sub âŸ¦ Î“â‚š âŸ§Cp âŸ¦ Î“â‚œ âŸ§Ct

âŸ¦_âŸ§Cp {Î“â‚œ} â—‡â‚š        = âŸ¦ Î“â‚œ âŸ§Ct
âŸ¦_âŸ§Cp {Î“â‚œ} (Î“â‚š â–¹â‚š A) = âŸ¦ Î“â‚š âŸ§Cp M.â–¹â‚š âŸ¦ A âŸ§F' M.[ âŸ¦pâŸ§ {Î“â‚œ}{Î“â‚š} ]á¶ 

âŸ¦pâŸ§ {Î“â‚œ} {â—‡â‚š} = M.id
âŸ¦pâŸ§ {Î“â‚œ} {Î“â‚š â–¹â‚š A} = âŸ¦pâŸ§ {Î“â‚œ} {Î“â‚š} M.âˆ˜ M.pâ‚š

âŸ¦_âŸ§T' : âˆ€{Î“â‚œ} â†’ S.Tm Î“â‚œ â†’ M.Tm âŸ¦ Î“â‚œ âŸ§Ct
âŸ¦_âŸ§Ts' : âˆ€{n Î“â‚œ} â†’ S.Tm Î“â‚œ ^ n â†’ M.Tm âŸ¦ Î“â‚œ âŸ§Ct ^ n
âŸ¦ var vz âŸ§T' = M.qâ‚œ
âŸ¦ var (vs x) âŸ§T' = âŸ¦ var x âŸ§T' M.[ M.pâ‚œ ]áµ—
âŸ¦ fun ar ts âŸ§T' = M.fun ar âŸ¦ ts âŸ§Ts'

âŸ¦_âŸ§Ts' {zero} ts = _
âŸ¦_âŸ§Ts' {suc n} (t , ts) = âŸ¦ t âŸ§T' , âŸ¦ ts âŸ§Ts'

âŸ¦ A âŠƒ B âŸ§F' = âŸ¦ A âŸ§F' M.âŠƒ âŸ¦ B âŸ§F'
âŸ¦ A âˆ§ B âŸ§F' = âŸ¦ A âŸ§F' M.âˆ§ âŸ¦ B âŸ§F'
âŸ¦ âŠ¤ âŸ§F' = M.âŠ¤
âŸ¦ A âˆ¨ B âŸ§F' = âŸ¦ A âŸ§F' M.âˆ¨ âŸ¦ B âŸ§F'
âŸ¦ âŠ¥ âŸ§F' = M.âŠ¥
âŸ¦ Forall A âŸ§F' = M.Forall âŸ¦ A âŸ§F'
âŸ¦ âˆƒ A âŸ§F' = M.âˆƒ âŸ¦ A âŸ§F'
âŸ¦ Rel ar ts âŸ§F' = M.Rel ar âŸ¦ ts âŸ§Ts'

âŸ¦_âŸ§F : âˆ€{Î“} â†’ I.For Î“ â†’ M.For âŸ¦ Î“ âŸ§C
âŸ¦_âŸ§F {Î“â‚œ , Î“â‚š} A = âŸ¦ A âŸ§F' M.[ âŸ¦pâŸ§ {Î“â‚œ}{Î“â‚š} ]á¶ 

âŸ¦_âŸ§T : âˆ€{Î“} â†’ I.Tm Î“ â†’ M.Tm âŸ¦ Î“ âŸ§C
âŸ¦_âŸ§T {Î“â‚œ , Î“â‚š} t = âŸ¦ t âŸ§T' M.[ âŸ¦pâŸ§ {Î“â‚œ}{Î“â‚š} ]áµ—

âŸ¦_âŸ§S : âˆ€{Î“ Î”} â†’ I.Sub Î” Î“ â†’ M.Sub âŸ¦ Î” âŸ§C âŸ¦ Î“ âŸ§C
âŸ¦_âŸ§S {Î“â‚œ , Î“â‚š}{Î”â‚œ , Î”â‚š} (Î³â‚œ , Î³â‚š) = {!!}

âŸ¦p'âŸ§ : âˆ€{Î“â‚œ}{Î“â‚š : S.Conp Î“â‚œ} â†’ M.Sub (âŸ¦ Î“â‚š âŸ§Cp M.â–¹â‚œ) âŸ¦ Î“â‚š S.[ S.pâ‚œ ]Conp âŸ§Cp
âŸ¦p'âŸ§ {Î“â‚œ}{â—‡â‚š} = M.id
âŸ¦p'âŸ§ {Î“â‚œ}{Î“â‚š â–¹â‚š A} = âŸ¦p'âŸ§ {Î“â‚œ}{Î“â‚š} M.âˆ˜ (M.pâ‚š M.âˆ˜ M.pâ‚œ M.,â‚œ M.qâ‚œ) M.,â‚š substP (M.Pf _) {!!} (M.qâ‚š M.[ M.pâ‚œ ]áµ–)


âŸ¦_âŸ§P : âˆ€{Î“ A} â†’ I.Pf Î“ A â†’ M.Pf âŸ¦ Î“ âŸ§C (âŸ¦_âŸ§F {Î“} A)
âŸ¦ a [ Î³ ]áµ– âŸ§P = {!!}
âŸ¦ a [ Î³â‚š ]áµ–áµ– âŸ§P = {!!}
âŸ¦ qâ‚š âŸ§P = substP (M.Pf _) (M.[âˆ˜]á¶  â»Â¹) M.qâ‚š
âŸ¦ âŠƒin b âŸ§P = substP (M.Pf _) (M.âŠƒ[] â»Â¹) (M.âŠƒin (substP (M.Pf _) M.[âˆ˜]á¶  âŸ¦ b âŸ§P))
âŸ¦ âŠƒout f a âŸ§P = M.âŠƒout (substP (M.Pf _) M.âŠƒ[] âŸ¦ f âŸ§P) âŸ¦ a âŸ§P
âŸ¦ âˆ§in a b âŸ§P = substP (M.Pf _) (M.âˆ§[] â»Â¹) (M.âˆ§in âŸ¦ a âŸ§P âŸ¦ b âŸ§P)
âŸ¦ âˆ§outâ‚ a âŸ§P = M.âˆ§outâ‚ (substP (M.Pf _) M.âˆ§[] âŸ¦ a âŸ§P)
âŸ¦ âˆ§outâ‚‚ b âŸ§P = M.âˆ§outâ‚‚ (substP (M.Pf _) M.âˆ§[] âŸ¦ b âŸ§P)
âŸ¦ âŠ¤in âŸ§P = substP (M.Pf _) (M.âŠ¤[] â»Â¹) M.âŠ¤in
âŸ¦ âˆ¨inâ‚ a âŸ§P = substP (M.Pf _) (M.âˆ¨[] â»Â¹) (M.âˆ¨inâ‚ âŸ¦ a âŸ§P)
âŸ¦ âˆ¨inâ‚‚ b âŸ§P = substP (M.Pf _) (M.âˆ¨[] â»Â¹) (M.âˆ¨inâ‚‚ âŸ¦ b âŸ§P)
âŸ¦ âˆ¨out ac bc ab âŸ§P = M.âˆ¨out (substP (M.Pf _) M.[âˆ˜]á¶  âŸ¦ ac âŸ§P) (substP (M.Pf _) M.[âˆ˜]á¶  âŸ¦ bc âŸ§P) (substP (M.Pf _) M.âˆ¨[] âŸ¦ ab âŸ§P)
âŸ¦ âŠ¥out p âŸ§P = M.âŠ¥out (substP (M.Pf _) M.âŠ¥[] âŸ¦ p âŸ§P)
âŸ¦_âŸ§P {Î“â‚œ , Î“â‚š}{S.Forall A} (âˆ€in a) = substP (M.Pf _) (M.Forall[] â»Â¹) (M.âˆ€in (substP (M.Pf _) (M.[âˆ˜]á¶  â»Â¹ â—¾ cong (Î» z â†’ âŸ¦ A âŸ§F' M.[ z ]á¶ ) {!!}) (âŸ¦ a âŸ§P M.[ âŸ¦p'âŸ§ {Î“â‚œ}{Î“â‚š} ]áµ–)))
âŸ¦ âˆ€out p âŸ§P = {!!}
âŸ¦ âˆƒin t p âŸ§P = {!!}
âŸ¦ âˆƒout p pâ‚ âŸ§P = {!!}
-}
-}
