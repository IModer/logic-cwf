{-# OPTIONS --prop #-}

open import lib
open import FirstOrderIntuinistic

module FI-KripkeModel
  (funar : â„• â†’ Set)
  (relar : â„• â†’ Set)
  (W : Set)
  (_â‰¤_ : W â†’ W â†’ Prop)
  (idâ‰¤ : {w : W} â†’ w â‰¤ w)
  (_âˆ˜â‰¤_ : {w w' w'' : W} â†’ w' â‰¤ w â†’ w'' â‰¤ w' â†’ w'' â‰¤ w)
  (Tm : Set)
  (Rel : (n : â„•) â†’ relar n â†’ (Tm ^ n) â†’ W â†’ Prop)
  (Relâ‰¤ : âˆ€{n}{ar : relar n}{ts : Tm ^ n}{w w'} â†’ Rel n ar ts w â†’ w' â‰¤ w â†’ Rel n ar ts w')
  (fun : (n : â„•) â†’ funar n â†’ (Tm ^ n) â†’ Tm)
  where

  record Conp : Setâ‚ where
    field
      âˆ£_âˆ£    : W â†’ Prop
      _âˆ¶_âŸ¨_âŸ© : âˆ€{w w'} â†’ âˆ£_âˆ£ w â†’ w' â‰¤ w â†’ âˆ£_âˆ£ w'
  open Conp public

  record For (Î“t : Set) : Setâ‚ where
    field
      âˆ£_âˆ£    : Î“t â†’ W â†’ Prop
      _âˆ¶_âŸ¨_âŸ© : âˆ€{w w'}{Î³tâ‚“ : Î“t} â†’ âˆ£_âˆ£ Î³tâ‚“ w â†’ w' â‰¤ w â†’ âˆ£_âˆ£ Î³tâ‚“ w'
  open For public

  KripkeModel : Model funar relar _ _ _ _ _
  KripkeModel = record
    { Con = Î£ Set Î» Î“ â†’ Î“ â†’ Conp -- set built using Tm and the proof assumptions
    ; Sub = Î» (Î”t ,Î£ Î”p) (Î“t ,Î£ Î“p) â†’ Î£sp (Î”t â†’ Î“t) Î» Î³t â†’ âˆ€{w}(Î´tâ‚“ : Î”t) â†’ âˆ£ Î”p Î´tâ‚“ âˆ£ w â†’ âˆ£ Î“p (Î³t Î´tâ‚“) âˆ£ w
    ; _âˆ˜_ = Î» (Î³t ,Î£ Î³p) (Î´t ,Î£ Î´p) â†’ (Î» Î¸tâ‚“ â†’ Î³t (Î´t Î¸tâ‚“)) ,Î£ (Î» Î¸tâ‚“ Î¸pâ‚“ â†’ Î³p (Î´t Î¸tâ‚“) (Î´p Î¸tâ‚“ Î¸pâ‚“) )
    ; id = (Î» Î³tâ‚“ â†’ Î³tâ‚“) ,Î£ (Î» Î³tâ‚“ Î³pâ‚“ â†’ Î³pâ‚“)
    ; ass = refl
    ; idl = refl
    ; idr = refl
    ; â—† = ğŸ™ ,Î£ Î» _ â†’ record { âˆ£_âˆ£ = Î» _ â†’ ğŸ™p ; _âˆ¶_âŸ¨_âŸ© = Î» _ _ â†’ * }
    ; Îµ = (Î» _ â†’ *) ,Î£ (Î» _ _ â†’ *)
    ; â—†Î· = Î» _ â†’ refl
    ; For = Î» (Î“t ,Î£ Î“p) â†’ For Î“t
    ; _[_]F = Î» A (Î³t ,Î£ Î³p) â†’ record
      { âˆ£_âˆ£ = Î» Î´tâ‚“ w â†’ âˆ£ A âˆ£ (Î³t Î´tâ‚“) w
      ; _âˆ¶_âŸ¨_âŸ© = Î» aâ‚“ f â†’ A âˆ¶ aâ‚“ âŸ¨ f âŸ© }
    ; [âˆ˜]F = refl
    ; [id]F = refl
    ; Pf = Î» (Î“t ,Î£ Î“p) A â†’ (Î³tâ‚“ : Î“t) â†’ {w : W}(Î³pâ‚“ : âˆ£ Î“p Î³tâ‚“ âˆ£ w) â†’ âˆ£ A âˆ£ Î³tâ‚“ w
    ; _[_]p = Î» a (Î³t ,Î£ Î³p) Î´tâ‚“ Î´pâ‚“ â†’ a (Î³t Î´tâ‚“) (Î³p _ Î´pâ‚“)
    ; _â–¸p_ = Î» (Î“t ,Î£ Î“p) A â†’ Î“t ,Î£ Î» Î³tâ‚“ â†’ record
        { âˆ£_âˆ£ = Î» w â†’ Î£p (âˆ£ Î“p Î³tâ‚“ âˆ£ w) Î» Î³pâ‚“ â†’ âˆ£ A âˆ£ Î³tâ‚“ w
        ; _âˆ¶_âŸ¨_âŸ© = Î» (Î³pâ‚“ ,Î£ aâ‚“) f â†’ Î“p Î³tâ‚“ âˆ¶ Î³pâ‚“ âŸ¨ f âŸ© ,Î£ (A âˆ¶ aâ‚“ âŸ¨ f âŸ©) }
    ; _,p_ = Î» (Î³t ,Î£ Î³p) a â†’ (Î» Î´tâ‚“ â†’ Î³t Î´tâ‚“) ,Î£ Î» Î´tâ‚“ Î´pâ‚“ â†’ Î³p Î´tâ‚“ Î´pâ‚“ ,Î£ a Î´tâ‚“ Î´pâ‚“
    ; pp = (Î» Î³tâ‚“ â†’ Î³tâ‚“) ,Î£ Î» Î³tâ‚“ (Î³pâ‚“ ,Î£ aâ‚“) â†’ Î³pâ‚“
    ; qp = Î» Î³tâ‚“ (Î³pâ‚“ ,Î£ aâ‚“) â†’ aâ‚“
    ; â–¸pÎ²â‚ = refl
    ; â–¸pÎ· = refl
    ; âŠ¥ = record { âˆ£_âˆ£ = Î» _ _ â†’ ğŸ˜p ; _âˆ¶_âŸ¨_âŸ© = Î» () }
    ; âŠ¥[] = refl
    ; exfalso = Î» 0p Î³tâ‚“ Î³pâ‚“ â†’ indğŸ˜p (0p Î³tâ‚“ Î³pâ‚“)
    ; âŠ¤ = record { âˆ£_âˆ£ = Î» _ _ â†’ ğŸ™p ; _âˆ¶_âŸ¨_âŸ© = Î» _ _ â†’ * }
    ; âŠ¤[] = refl
    ; tt = Î» _ _ â†’ *
    ; _âŠƒ_ = Î» A B â†’ record { âˆ£_âˆ£ = Î» Î³tâ‚“ w â†’ âˆ€{w'} â†’ w' â‰¤ w â†’ âˆ£ A âˆ£ Î³tâ‚“ w' â†’ âˆ£ B âˆ£ Î³tâ‚“ w' ; _âˆ¶_âŸ¨_âŸ© = Î» pâ‚“ f g â†’ pâ‚“ (f âˆ˜â‰¤ g) }
    ; âŠƒ[] = refl
    ; âŠƒintro = Î» {(Î“t ,Î£ Î“p) ,Î£ A} b Î³tâ‚“ Î³pâ‚“ f aâ‚“ â†’ b Î³tâ‚“ (Î“p Î³tâ‚“ âˆ¶ Î³pâ‚“ âŸ¨ f âŸ© ,Î£ aâ‚“)
    ; âŠƒelim = Î» p Î³tâ‚“ (Î³pâ‚“ ,Î£ aâ‚“) â†’ p Î³tâ‚“ Î³pâ‚“ idâ‰¤ aâ‚“
    ; _âˆ§_ = Î» A B â†’ record { âˆ£_âˆ£ = Î» Î³tâ‚“ Î³pâ‚“ â†’ âˆ£ A âˆ£ Î³tâ‚“ Î³pâ‚“ Ã—p âˆ£ B âˆ£ Î³tâ‚“ Î³pâ‚“ ; _âˆ¶_âŸ¨_âŸ© = Î» (aâ‚“ ,Î£ bâ‚“) f â†’ (A âˆ¶ aâ‚“ âŸ¨ f âŸ©) ,Î£ (B âˆ¶ bâ‚“ âŸ¨ f âŸ©) }
    ; âˆ§[] = refl
    ; âˆ§intro = Î» a b Î³tâ‚“ Î³pâ‚“ â†’ a Î³tâ‚“ Î³pâ‚“ ,Î£ b Î³tâ‚“ Î³pâ‚“
    ; âˆ§elimâ‚ = Î» ab Î³tâ‚“ Î³pâ‚“ â†’ projâ‚ (ab Î³tâ‚“ Î³pâ‚“)
    ; âˆ§elimâ‚‚ = Î» ab Î³tâ‚“ Î³pâ‚“ â†’ projâ‚‚ (ab Î³tâ‚“ Î³pâ‚“)
    ; _âˆ¨_ = Î» A B â†’ record { âˆ£_âˆ£ = Î» Î³tâ‚“ w â†’ âˆ£ A âˆ£ Î³tâ‚“ w +p âˆ£ B âˆ£ Î³tâ‚“ w ; _âˆ¶_âŸ¨_âŸ© = Î» { (injâ‚ aâ‚“) f â†’ injâ‚ (A âˆ¶ aâ‚“ âŸ¨ f âŸ©) ; (injâ‚‚ bâ‚“) f â†’ injâ‚‚ (B âˆ¶ bâ‚“ âŸ¨ f âŸ©) } }
    ; âˆ¨[] = refl
    ; âˆ¨elim = Î» {_}{_}{_}{C} f g ab Î³tâ‚“ {w} Î³pâ‚“ â†’ ind+p (Î» _ â†’ âˆ£ C âˆ£ Î³tâ‚“ w) (Î» aâ‚“ â†’ f Î³tâ‚“ (Î³pâ‚“ ,Î£ aâ‚“)) (Î» bâ‚“ â†’ g Î³tâ‚“ (Î³pâ‚“ ,Î£ bâ‚“)) (ab Î³tâ‚“ Î³pâ‚“)
    ; âˆ¨introâ‚ = Î» a Î³tâ‚“ Î³pâ‚“ â†’ injâ‚ (a Î³tâ‚“ Î³pâ‚“)
    ; âˆ¨introâ‚‚ = Î» b Î³tâ‚“ Î³pâ‚“ â†’ injâ‚‚ (b Î³tâ‚“ Î³pâ‚“)
    ; Tm = Î» (Î“t ,Î£ Î“p) â†’ Î“t â†’ Tm
    ; _[_]t = Î» t (Î³t ,Î£ Î³p) Î´tâ‚“ â†’ t (Î³t Î´tâ‚“)
    ; [âˆ˜]t = refl
    ; [id]t = refl
    ; _â–¸t = Î» (Î“t ,Î£ Î“p) â†’ (Î“t Ã— Tm) ,Î£ (Î» (Î³tâ‚“ ,Î£ tâ‚“) â†’ Î“p Î³tâ‚“)
    ; _,t_ = Î» (Î³t ,Î£ Î³p) t â†’ (Î» Î´tâ‚“ â†’ Î³t Î´tâ‚“ ,Î£ t Î´tâ‚“) ,Î£ Î» Î´tâ‚“ Î´pâ‚“ â†’ Î³p Î´tâ‚“ Î´pâ‚“
    ; pt = (Î» (Î³tâ‚“ ,Î£ tâ‚“) â†’ Î³tâ‚“) ,Î£ (Î» _ Î³pâ‚“ â†’ Î³pâ‚“)
    ; qt = Î» (Î³tâ‚“ ,Î£ tâ‚“) â†’ tâ‚“
    ; â–¸tÎ²â‚ = refl
    ; â–¸tÎ²â‚‚ = refl
    ; â–¸tÎ· = refl
    ; Tms = Î» (Î“t ,Î£ Î“p) n â†’ Î“t â†’ Tm ^ n
    ; _[_]ts = Î» ts (Î³t ,Î£ Î³p) Î´tâ‚“ â†’ ts (Î³t Î´tâ‚“)
    ; [âˆ˜]ts = refl
    ; [id]ts = refl
    ; Îµs = Î» _ â†’ *
    ; â—†sÎ· = Î» _ â†’ refl
    ; _,s_ = Î» ts t Î³tâ‚“ â†’ t Î³tâ‚“ ,Î£ ts Î³tâ‚“
    ; Ï€â‚ = Î» ts Î³tâ‚“ â†’ projâ‚‚ (ts Î³tâ‚“)
    ; Ï€â‚‚ = Î» ts Î³tâ‚“ â†’ projâ‚ (ts Î³tâ‚“)
    ; â–¸sÎ²â‚ = refl
    ; â–¸sÎ²â‚‚ = refl
    ; â–¸sÎ· = refl
    ; ,[] = refl
    ; fun = Î» n ar ts Î³tâ‚“ â†’ fun n ar (ts Î³tâ‚“)
    ; fun[] = refl
    ; rel = Î» n ar ts â†’ record { âˆ£_âˆ£ = Î» Î³tâ‚“ w â†’ Rel n ar (ts Î³tâ‚“) w ; _âˆ¶_âŸ¨_âŸ© = Relâ‰¤ }
    ; rel[] = refl
    ; âˆ€' = Î» A â†’ record { âˆ£_âˆ£ = Î» Î³tâ‚“ w â†’ (tâ‚“ : Tm) â†’ âˆ£ A âˆ£ (Î³tâ‚“ ,Î£ tâ‚“) w ; _âˆ¶_âŸ¨_âŸ© = Î» âˆ€aâ‚“ f tâ‚“ â†’ A âˆ¶ âˆ€aâ‚“ tâ‚“ âŸ¨ f âŸ© }
    ; âˆ€[] = refl
    ; âˆ€intro = Î» a Î³tâ‚“ Î³pâ‚“ tâ‚“ â†’ a (Î³tâ‚“ ,Î£ tâ‚“) Î³pâ‚“
    ; âˆ€elim = Î» âˆ€a (Î³tâ‚“ ,Î£ tâ‚“) Î³pâ‚“ â†’ âˆ€a Î³tâ‚“ Î³pâ‚“ tâ‚“
    ; âˆƒ' = Î» A â†’ record { âˆ£_âˆ£ = Î» Î³tâ‚“ w â†’ âˆƒ Tm Î» tâ‚“ â†’ âˆ£ A âˆ£ (Î³tâ‚“ ,Î£ tâ‚“) w ; _âˆ¶_âŸ¨_âŸ© = Î» âˆƒaâ‚“ f â†’ withâˆƒ âˆƒaâ‚“ Î» tâ‚“ aâ‚“ â†’ tâ‚“ ,âˆƒ (A âˆ¶ aâ‚“ âŸ¨ f âŸ©) }
    ; âˆƒ[] = refl
    ; âˆƒintro = Î» t aâ‚“ Î³tâ‚“ Î³pâ‚“ â†’ t Î³tâ‚“ ,âˆƒ aâ‚“ Î³tâ‚“ Î³pâ‚“
    ; âˆƒelim = Î» âˆƒa b Î³tâ‚“ Î³pâ‚“ â†’ withâˆƒ (âˆƒa Î³tâ‚“ Î³pâ‚“) Î» tâ‚“ aâ‚“ â†’ b (Î³tâ‚“ ,Î£ tâ‚“) (Î³pâ‚“ ,Î£ aâ‚“)
    ; Eq = Î» t t' â†’ record { âˆ£_âˆ£ = Î» Î³tâ‚“ w â†’ t Î³tâ‚“ â‰¡ t' Î³tâ‚“ ; _âˆ¶_âŸ¨_âŸ© = Î» e _ â†’ e }
    ; Eq[] = refl
    ; Eqrefl = Î» _ _ â†’ refl
    ; subst' = Î» { {Î“t ,Î£ Î“p} A {t}{t'} e a Î³tâ‚“ {w} Î³pâ‚“ â†’ substp (Î» tâ‚“ â†’ âˆ£ A âˆ£ (Î³tâ‚“ ,Î£ tâ‚“) w) (e Î³tâ‚“ Î³pâ‚“) (a Î³tâ‚“ Î³pâ‚“) }
    } 
